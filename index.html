<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Match Cut | Arnavsocial</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        background: '#f5f5f7',
                        surface: '#ffffff',
                        primary: '#000000',
                    },
                    borderRadius: {
                        'squircle': '22px',
                    },
                    transitionTimingFunction: {
                        'spring': 'cubic-bezier(0.25, 0.8, 0.25, 1)',
                    }
                }
            }
        }
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <style>
        body { background-color: #f5f5f7; color: #1d1d1f; overflow: hidden; }
        
        /* THE TEXTURE: Deep Blue Nebula */
        .texture-bg {
            background: radial-gradient(circle at 20% 0%, #1e40af 0%, #0f172a 60%, #020617 100%);
            box-shadow: 0 4px 20px rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Apple-style smooth corners */
        .squircle {
            border-radius: 20px;
        }

        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #3b82f6, #0f172a);
            cursor: pointer;
            margin-top: -10px; 
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            transition: transform 0.15s ease;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.15); }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e5e5e5;
            border-radius: 999px;
        }

        /* Smooth Toggle Switch */
        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        }
        
        .toggle-label {
            width: 44px;
            height: 24px;
            background-color: #e5e5e5;
            border-radius: 999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-label::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .toggle-checkbox:checked + .toggle-label {
            background: #1e3a8a; /* Deep blue match */
        }

        .toggle-checkbox:checked + .toggle-label::after {
            transform: translateX(20px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // --- ICONS ---
        const IconUpload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const IconPlay = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const IconPause = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const IconLoader = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>;
        const IconSparkles = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></svg>;
        const IconCrop = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2v14a2 2 0 0 0 2 2h14"/><path d="M18 22V8a2 2 0 0 0-2-2H2"/></svg>;
        const IconGhost = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="black" stroke="none"><path d="M9 22H15C20 22 22 19 22 15V7C22 4 20 2 15 2H9C4 2 2 4 2 7V15C2 19 4 22 9 22Z" opacity="0.4"/><path d="M15.75 12C15.75 12.41 15.41 12.75 15 12.75H9C8.59 12.75 8.25 12.41 8.25 12C8.25 11.59 8.59 11.25 9 11.25H15C15.41 11.25 15.75 11.59 15.75 12Z"/><circle cx="10" cy="9" r="1"/><circle cx="14" cy="9" r="1"/></svg>;
        
        // Social Icons Component
        const SocialIcon = ({ type }) => {
            const classes = "w-10 h-10 squircle bg-white shadow-sm border border-gray-100 flex items-center justify-center hover:scale-110 hover:shadow-md transition-all duration-300 ease-spring cursor-pointer";
            
            if (type === 'github') return (
                <a href="https://github.com/arnavsocial" target="_blank" className={classes}>
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="#181717"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.419-1.305.763-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
                </a>
            );
            
            // Fixed Instagram Button
            if (type === 'instagram') return (
                <a href="https://www.instagram.com/arnavsocial/" target="_blank" className={classes}>
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor" style={{color: '#E1306C'}}>
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>
            );
            
            if (type === 'gmail') return (
                <a href="potato" target="_blank" className={classes}>
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="#EA4335"><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg>
                </a>
            );
            return null;
        };

        const RATIOS = {
            '1:1': { w: 1024, h: 1024, aspect: 'aspect-square' },
            '9:16': { w: 1080, h: 1920, aspect: 'aspect-[9/16]' },
            '16:9': { w: 1920, h: 1080, aspect: 'aspect-[16/9]' },
            'Free': { w: 2048, h: 2048, aspect: 'aspect-square' } // 2K Square
        };

        const gifWorkerBlob = new Blob([`importScripts('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');`], { type: 'application/javascript' });
        const gifWorkerUrl = URL.createObjectURL(gifWorkerBlob);
        const getDistance = (p1, p2) => Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));

        function App() {
            // State
            const [images, setImages] = useState([]);
            const [status, setStatus] = useState('idle');
            const [previewIndex, setPreviewIndex] = useState(0);
            const [isPlaying, setIsPlaying] = useState(true);
            const [exportProgress, setExportProgress] = useState(0);
            const [isDragging, setIsDragging] = useState(false);
            
            // Settings
            const [speed, setSpeed] = useState(0.2);
            const [layoutScale, setLayoutScale] = useState(50);
            const [ratio, setRatio] = useState('1:1');
            const [format, setFormat] = useState('GIF');
            const [showGuides, setShowGuides] = useState(true);
            const [cropMode, setCropMode] = useState('smart');
            const [modelReady, setModelReady] = useState(false);

            // Refs
            const canvasRef = useRef(null);
            const faceMeshRef = useRef(null);
            const processingQueueRef = useRef([]);
            const fileInputRef = useRef(null);

            const validImages = useMemo(() => images.filter(i => i.status === 'ready'), [images]);

            // 1. Init
            useEffect(() => {
                const initModel = async () => {
                    try {
                        const faceMesh = new FaceMesh({
                            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/${file}`
                        });
                        faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.1, minTrackingConfidence: 0.1 });
                        faceMesh.onResults(handleResults);
                        await faceMesh.initialize();
                        faceMeshRef.current = faceMesh;
                        setModelReady(true);
                    } catch (e) { console.error("AI Init Failed", e); }
                };
                initModel();
            }, []);

            // 2. Draw
            const drawFrame = useCallback((ctx, imgData, w, h) => {
                ctx.fillStyle = '#121212';
                ctx.fillRect(0, 0, w, h);

                if (!imgData || !imgData.img) return;

                if (imgData.landmarks) {
                    const { img, landmarks } = imgData;
                    const { leftEye, rightEye } = landmarks;

                    const p1 = { x: leftEye.x * img.width, y: leftEye.y * img.height };
                    const p2 = { x: rightEye.x * img.width, y: rightEye.y * img.height };
                    const srcDist = getDistance(p1, p2);
                    const srcMid = { x: (p1.x + p2.x) / 2, y: (p1.y + p2.y) / 2 };
                    const srcAngle = Math.atan2(p2.y - p1.y, p2.x - p1.x);

                    const tgtMid = { x: w * 0.5, y: h * 0.5 };
                    const baseCoverage = 0.20; 
                    const scaleModifier = layoutScale / 50; 
                    const tgtDist = w * (baseCoverage * scaleModifier);

                    const scale = tgtDist / srcDist;
                    const rotation = cropMode === 'smart' ? -srcAngle : 0;

                    ctx.save();
                    ctx.translate(tgtMid.x, tgtMid.y);
                    ctx.rotate(rotation);
                    ctx.scale(scale, scale);
                    ctx.translate(-srcMid.x, -srcMid.y);
                    
                    ctx.shadowColor = 'black';
                    ctx.shadowBlur = 40;
                    ctx.shadowOffsetY = 10;

                    ctx.drawImage(img, 0, 0);
                    ctx.restore();

                    if (showGuides) {
                        ctx.save();
                        ctx.strokeStyle = '#22d3ee';
                        ctx.lineWidth = 2 * (1/scaleModifier); 
                        ctx.globalAlpha = 0.5;
                        const eyeOffset = tgtDist / 2;
                        
                        ctx.beginPath(); ctx.arc(tgtMid.x - eyeOffset, tgtMid.y, 10, 0, Math.PI * 2); ctx.stroke();
                        ctx.beginPath(); ctx.arc(tgtMid.x + eyeOffset, tgtMid.y, 10, 0, Math.PI * 2); ctx.stroke();
                        ctx.restore();
                    }

                } else {
                    const img = imgData.img;
                    const scale = Math.min(w / img.width, h / img.height);
                    const x = (w - img.width * scale) / 2;
                    const y = (h - img.height * scale) / 2;
                    ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                }
            }, [layoutScale, cropMode, showGuides]);

            // 3. Process
            const processImages = async (queue) => {
                if (!faceMeshRef.current || !modelReady) return;
                setStatus('processing');
                for (let img of queue) {
                    if (img.status !== 'pending') continue;
                    processingQueueRef.current = img.id;
                    setImages(prev => prev.map(i => i.id === img.id ? { ...i, status: 'processing' } : i));
                    try { await faceMeshRef.current.send({ image: img.img }); await new Promise(r => setTimeout(r, 50)); } catch(e) {}
                }
                setStatus('idle');
            };

            const handleResults = (results) => {
                const currentId = processingQueueRef.current;
                if (!currentId) return;
                if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                    const lm = results.multiFaceLandmarks[0];
                    let leftEye, rightEye;
                    if (lm.length > 468) { leftEye = lm[468]; rightEye = lm[473]; } else { leftEye = { x: (lm[33].x + lm[133].x)/2, y: (lm[33].y + lm[133].y)/2 }; rightEye = { x: (lm[362].x + lm[263].x)/2, y: (lm[362].y + lm[263].y)/2 }; }
                    setImages(prev => prev.map(img => img.id === currentId ? { ...img, status: 'ready', landmarks: { leftEye, rightEye } } : img));
                    processingQueueRef.current = null; 
                } else {
                    setImages(prev => prev.map(img => img.id === currentId ? { ...img, status: 'error' } : img));
                }
            };

            const handleFiles = async (files) => {
                const validFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
                if (validFiles.length === 0) return;
                const newImages = [];
                for (const file of validFiles) {
                    const src = await new Promise(r => { const reader = new FileReader(); reader.onload = e => r(e.target.result); reader.readAsDataURL(file); });
                    const img = new Image(); img.src = src; await new Promise(r => img.onload = r);
                    newImages.push({ id: Math.random().toString(36).substr(2, 9), src, img, status: 'pending' });
                }
                const updated = [...images, ...newImages];
                setImages(updated);
                processImages(updated);
            };

            const onDrop = (e) => { e.preventDefault(); setIsDragging(false); handleFiles(e.dataTransfer.files); };
            const handleDragEnter = (e) => { e.preventDefault(); setIsDragging(true); };
            const handleDragLeave = (e) => { e.preventDefault(); setIsDragging(false); };

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const dims = RATIOS[ratio];
                canvas.width = dims.w; canvas.height = dims.h;
                if (validImages.length === 0) { ctx.fillStyle = '#171717'; ctx.fillRect(0, 0, dims.w, dims.h); return; }
                const safeIndex = previewIndex % validImages.length;
                drawFrame(ctx, validImages[safeIndex], dims.w, dims.h);
                if (isPlaying && validImages.length > 1) {
                    const timeout = setTimeout(() => { setPreviewIndex(prev => (prev + 1) % validImages.length); }, speed * 1000);
                    return () => clearTimeout(timeout);
                }
            }, [validImages, previewIndex, isPlaying, speed, ratio, cropMode, showGuides, layoutScale, drawFrame]);

            const handleExport = async () => {
                if (validImages.length === 0) return;
                setStatus('exporting'); setExportProgress(0); setIsPlaying(false);
                const dims = RATIOS[ratio];
                const canvas = document.createElement('canvas'); canvas.width = dims.w; canvas.height = dims.h; const ctx = canvas.getContext('2d');
                try {
                    if (format === 'GIF') {
                        const gif = new GIF({ workers: 2, quality: 10, workerScript: gifWorkerUrl, width: dims.w, height: dims.h });
                        validImages.forEach(img => { drawFrame(ctx, img, dims.w, dims.h); gif.addFrame(ctx, { copy: true, delay: speed * 1000 }); });
                        gif.on('progress', p => setExportProgress(Math.round(p * 100)));
                        gif.on('finished', blob => { const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'match-cut.gif'; a.click(); setStatus('idle'); setIsPlaying(true); });
                        gif.render();
                    } else {
                        const stream = canvas.captureStream(30); const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' }); const chunks = [];
                        recorder.ondataavailable = e => chunks.push(e.data);
                        recorder.onstop = () => { const blob = new Blob(chunks, { type: 'video/webm' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'match-cut.webm'; a.click(); setStatus('idle'); setIsPlaying(true); };
                        recorder.start();
                        for (let i = 0; i < validImages.length; i++) { drawFrame(ctx, validImages[i], dims.w, dims.h); await new Promise(r => setTimeout(r, speed * 1000)); }
                        recorder.stop();
                    }
                } catch (e) { alert("Export failed"); setStatus('idle'); }
            };

            return (
                <div className="flex flex-col h-[100dvh] font-sans bg-[#f5f5f7] text-[#1d1d1f]">
                    {/* Header */}
                    <header className="h-16 flex items-center justify-between px-6 md:px-8 shrink-0 z-10 bg-[#f5f5f7] sticky top-0">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-white shadow-sm rounded-full flex items-center justify-center border border-gray-100">
                                <IconGhost />
                            </div>
                            <span className="font-semibold text-2xl tracking-tight text-black">Match Cut</span>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="hidden md:flex items-center gap-3">
                                <SocialIcon type="github" />
                                <SocialIcon type="instagram" />
                                <SocialIcon type="gmail" />
                            </div>
                            <div className={`px-3 py-1.5 rounded-full text-xs font-bold tracking-wide flex items-center gap-1.5 ${modelReady ? 'bg-green-100 text-green-600' : 'bg-gray-200 text-gray-500'}`}>
                                <div className={`w-1.5 h-1.5 rounded-full ${modelReady ? 'bg-green-500' : 'bg-gray-400'}`}></div>
                                {modelReady ? 'READY' : 'LOADING'}
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden p-4 md:p-6 gap-6">
                        
                        {/* Canvas Area (Resizable with Transition) */}
                        <div className="w-full h-[45vh] md:h-full md:flex-1 relative flex items-center justify-center perspective-1000">
                            {/* Animated Container for Ratio Switching */}
                            <div 
                                className={`relative squircle shadow-2xl overflow-hidden border border-black/5 bg-[#121212] transition-all duration-500 ease-spring ${RATIOS[ratio].aspect}`}
                                style={{ maxHeight: '100%', maxWidth: '100%' }}
                            >
                                <canvas ref={canvasRef} className="w-full h-full object-contain" />
                                
                                {/* Overlay Controls */}
                                <div className="absolute bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-4 px-6 py-2.5 bg-zinc-900/40 backdrop-blur-xl rounded-full text-white/90 shadow-2xl border border-white/5 transition-transform hover:scale-105 duration-200">
                                    <button onClick={() => setIsPlaying(!isPlaying)} className="hover:text-white transition-colors">
                                        {isPlaying ? <IconPause /> : <IconPlay />}
                                    </button>
                                    <span className="font-mono text-xs font-medium opacity-60">
                                        {validImages.length > 0 ? (previewIndex % validImages.length) + 1 : 0} / {validImages.length}
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* Controls Area */}
                        <div className="w-full md:w-[400px] flex flex-col h-full overflow-y-auto pb-6">
                            <div className="space-y-6">
                                
                                {/* Upload Box */}
                                <div 
                                    onClick={() => fileInputRef.current.click()}
                                    onDragEnter={handleDragEnter} onDragLeave={handleDragLeave} onDragOver={e => e.preventDefault()} onDrop={onDrop}
                                    className={`group h-32 squircle bg-gray-100 border border-transparent flex flex-col items-center justify-center text-center cursor-pointer transition-all hover:bg-white hover:shadow-md hover:scale-[1.01] duration-300
                                        ${isDragging ? 'bg-blue-50 border-blue-400' : ''}`}
                                >
                                    <input type="file" multiple accept="image/*" ref={fileInputRef} className="hidden" onChange={e => handleFiles(e.target.files)} />
                                    <div className="text-lg font-semibold text-gray-900 mb-1">Tap to add photos,</div>
                                    <div className="text-sm text-gray-500">Processed locally for your privacy.</div>
                                    {images.length > 0 && (
                                        <div className="mt-2 text-[10px] font-bold text-blue-600 bg-blue-100/50 px-2 py-0.5 rounded-full animate-fade-in">
                                            {images.length} Loaded
                                        </div>
                                    )}
                                </div>

                                {/* Size & Guides */}
                                <div className="flex items-center justify-between px-1">
                                    <div className="flex items-center gap-4">
                                        <span className="text-xs font-bold text-gray-500 uppercase tracking-wide">SIZE</span>
                                        <div className="flex bg-white shadow-sm border border-gray-100 p-1 rounded-xl">
                                            {Object.keys(RATIOS).map(r => (
                                                <button key={r} onClick={() => setRatio(r)} 
                                                    className={`px-3 py-1 rounded-lg text-xs font-semibold transition-all duration-300 ease-out ${ratio === r ? 'bg-black text-white shadow-md transform scale-105' : 'text-gray-500 hover:text-gray-900'}`}>
                                                    {r}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs font-bold text-gray-500 uppercase tracking-wide">GUIDES</span>
                                        <div className="relative inline-block w-11 align-middle select-none">
                                            <input type="checkbox" checked={showGuides} onChange={() => setShowGuides(!showGuides)} className="toggle-checkbox"/>
                                            <label className="toggle-label"></label>
                                        </div>
                                    </div>
                                </div>

                                {/* Playback Speed */}
                                <div className="space-y-3 px-1">
                                    <div className="flex justify-between items-center">
                                        <span className="text-xs font-bold text-black uppercase tracking-wide">PLAYBACK SPEED</span>
                                        <span className="text-xs text-gray-500 font-medium font-mono">SPEED {speed}s</span>
                                    </div>
                                    <input type="range" min="0.05" max="1.0" step="0.05" value={speed} onChange={e => setSpeed(parseFloat(e.target.value))} />
                                </div>

                                {/* Layout Scale & Export Row */}
                                <div className="grid grid-cols-2 gap-8 px-1">
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs font-bold text-black uppercase tracking-wide">LAYOUT SCALE</span>
                                            <span className="text-xs text-gray-500 font-medium font-mono">{layoutScale}%</span>
                                        </div>
                                        <input type="range" min="10" max="100" step="1" value={layoutScale} onChange={e => setLayoutScale(parseInt(e.target.value))} />
                                    </div>
                                    <div className="space-y-3">
                                        <span className="text-xs font-bold text-black uppercase block text-right tracking-wide">EXPORT</span>
                                        <div className="flex justify-end">
                                            <div className="flex bg-white border border-gray-200 p-1 rounded-xl shadow-sm">
                                                {['GIF', 'MP4'].map(f => (
                                                    <button key={f} onClick={() => setFormat(f)} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all duration-300 ${format === f ? 'bg-gray-100 text-black shadow-inner transform scale-105' : 'text-gray-400 hover:text-gray-600'}`}>{f}</button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Alignment Buttons */}
                                <div className="space-y-2 pt-2">
                                    <span className="text-xs font-bold text-black uppercase px-1 tracking-wide">ALIGNMENT MODE</span>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button 
                                            onClick={() => setCropMode('smart')}
                                            className={`h-14 squircle text-sm font-semibold flex items-center justify-center gap-2 transition-all duration-300 shadow-md text-white overflow-hidden relative
                                            ${cropMode === 'smart' ? 'texture-bg ring-2 ring-offset-2 ring-blue-500 transform scale-[1.02]' : 'bg-gray-800'}`}
                                        >
                                            <span className="relative z-10 flex items-center gap-2"><IconSparkles /> Smart Crop</span>
                                        </button>
                                        <button 
                                            onClick={() => setCropMode('crop')}
                                            className={`h-14 squircle text-sm font-semibold flex items-center justify-center gap-2 transition-all duration-300 border shadow-sm
                                            ${cropMode === 'crop' ? 'bg-white border-blue-500 text-blue-600 ring-1 ring-blue-500 transform scale-[1.02]' : 'bg-white border-gray-200 text-gray-700 hover:bg-gray-50'}`}
                                        >
                                            <IconCrop /> Crop
                                        </button>
                                    </div>
                                </div>

                                {/* Export Button */}
                                <button 
                                    onClick={handleExport} 
                                    disabled={status !== 'idle' || validImages.length < 2}
                                    className="w-full h-16 texture-bg text-white squircle font-bold text-lg flex items-center justify-center gap-3 shadow-xl hover:shadow-2xl hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed mt-4"
                                >
                                    {status === 'exporting' ? 
                                        <><IconLoader /> Exporting {exportProgress}%</> : 
                                        <><IconDownload /> Export Video</>
                                    }
                                </button>
                                
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
